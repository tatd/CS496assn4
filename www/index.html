
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
<!--
  <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
-->
<script src="https://code.jquery.com/jquery-3.0.0.js"></script>

<script src="https://code.jquery.com/jquery-migrate-3.0.0.js"></script>

<!--
  <script type="text/javascript" src="http://code.jquery.com/mobile/1.3.0-beta.1/jquery.mobile-1.3.0-beta.1.js"></script>
-->
   <script type="text/javascript" src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.js"></script>
<!--
  <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.3.0-beta.1/jquery.mobile-1.3.0-beta.1.css">
-->

  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

  <style type="text/css">
    .ui-bar {
    padding :5px 0px 5px 0px !important;
    margin :5px 0px 5px 0px !important;
}
  </style>

  <title>CS496 by Dennis Tat</title>
<div>
<script type='text/javascript'>//<![CDATA[

//assuming this comes from an ajax call
var info =[];
var locdata = [];

//pageinit event for first page
//triggers only once
//write all your on-load functions and event handlers pertaining to page1

/*
$(document).on("pageinit", "#testpage", function(){
        $.getJSON("https://cs496-1373.appspot.com/_ah/api/mylibrary/v1/locations", function(data){
            var output = '';
            locdata = [];
            locdata = data.items;
            $.each(locdata, function(index, value){                   
             output += '<li><a href="#" id="' + locdata.id + '">' +locdata.name+ '</a></li>';
            });
            $('#listitem').html(output);
        });
    });
*/
$(document).on("pageinit", "#loclist-page", function () {
    $.getJSON("https://cs496-1373.appspot.com/_ah/api/mylibrary/v1/locations", function(data){
            locdata = data.items;
            //console.log(locdata[0].name);

            info = locdata;
            //console.log(info);
            //console.log(locdata);
    //set up string for adding <li/>
    var li = "";
    //container for $li to be added
    $.each(info, function (i, location) {
        //add the <li> to "li" variable
        //note the use of += in the variable
        //meaning I'm adding to the existing data. not replacing it.
        //store index value in array as id of the <a> tag
        li += '<li><a href="#" id="' + i + '" class="info-go">' + location.name + '</a></li>';
    });
    //append list to ul
    $("#loc-list").append(li).promise().done(function () {
        //wait for append to finish - thats why you use a promise()
        //done() will run after append is done
        //add the click event for the redirection to happen to #details-page
        $(this).on("click", ".info-go", function (e) {
            e.preventDefault();
            //store the information in the next page's data
            $("#locdetails-page").data("info", info[this.id]);
            //change the page # to second page. 
            //Now the URL in the address bar will read index.html#details-page
            //where #details-page is the "id" of the second page
            //we're gonna redirect to that now using changePage() method
            $.mobile.changePage("#locdetails-page");
        });

        //refresh list to enhance its styling.
        $(this).listview("refresh");
    });
        });
    
});



//use pagebeforeshow
//DONT USE PAGEINIT! 
//the reason is you want this to happen every single time
//pageinit will happen only once
$(document).on("pagebeforeshow", "#locdetails-page", function () {
    //get from data - you put this here when the "a" wa clicked in the previous page
    var info = $(this).data("info");
    //string to put HTML in
    var info_view = "";
    var infoview = "";

    infoview += '<div class="ui-grid-a"><div class="ui-block-a"><div class="ui-bar field" style="font-weight : bold; text-align: left;">Name: ' + '</div></div><div class="ui-block-b"><div class="ui-bar value" style="width : 75%">' + info.name + '</div></div> <div class="ui-block-a"><div class="ui-bar field" style="font-weight : bold; text-align: left;">Phone Number: ' + '</div></div><div class="ui-block-b"><div class="ui-bar value" style="width : 75%">' + info.phone_number + '</div></div> </div>';

    //use for..in to iterate through object
    for (var key in info) {
        //Im using grid layout here.
        //use any kind of layout you want.
        //key is the key of the property in the object 
        //if obj = {name: 'k'}
        //key = name, value = k

        info_view += '<div class="ui-grid-a"><div class="ui-block-a"><div class="ui-bar field" style="font-weight : bold; text-align: left;">' + key + '</div></div><div class="ui-block-b"><div class="ui-bar value" style="width : 75%">' + info[key] + '</div></div></div>';
    }
    //add this to html
    $(this).find("[data-role=content]").html(infoview);
});
//]]> 

</script>

  
</head>

<body>
<!--
    <div data-role="page" id="testpage">
        <div data-role="content">    
             <ul data-role="listview" id="listitem" data-divider-theme="a" data-inset="true">
            </ul>
        </div>
    </div>
-->
  <!--Location list page -->
  
<div data-role="page" id="loclist-page">
    <div data-role="header" data-theme="b">
         <h1> Locations</h1>

    </div>
    
    <div data-role="content">
    <div>
        <a href="#addloc-page" class="ui-btn">Add Location</a>
    </div>
        <ul data-role="listview" id="loc-list" data-divider-theme="a" data-inset="true">
            <li data-role="list-divider" data-theme="b" role="heading">Locations</li>
        </ul>
    </div>
</div>

<!--location detail page -->
<div data-role="page" id="locdetails-page">
    <div data-role="header" data-theme="b"><a href="#" data-rel="back" data-role="button">Go back</a>

         <h1>Location Details</h1>

    </div>
    <div data-role="content"></div>
</div>
  
<!-- add location page -->
<div data-role="page" id="addloc-page">
    <div data-role="header" data-theme="b"><a href="#" data-rel="back" data-role="button">Go back</a>
         <h1>Add Location</h1>
    </div>
    <div data-role="main" class="ui-content">
    <form action="#info-page" method="post">

        <div>
        <label for="locNameInput">Name:</label>
        <input type="text" name="text" id="locNameInput" placeholder="Name">
        </div>
        <br>
        <div>
        <label for="locPhoneInput">Phone Number:</label>
        <input type="text" name="text" id="locPhoneInput" placeholder="xxx-xxx-xxxx">
        </div>
        <br>
        <div>
        <input type="submit" value="Add Location">
        </div>
    </form>
    </div>

    <div data-role="content"></div>
</div>

</body>

</html>

